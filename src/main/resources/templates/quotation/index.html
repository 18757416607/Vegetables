<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
    <meta charset="utf-8" />
    <title>资源信息</title>
    <link charset="UTF-8" rel="stylesheet" type="text/css" th:href="@{static/easyui/themes/bootstrap/easyui.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{static/easyui/themes/icon.css}" />
    <script type="text/javascript" th:src="@{static/easyui/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{static/easyui/jquery.easyui.min.js}"></script>
    <script type="text/javascript" th:src="@{static/easyui/locale/easyui-lang-zh_CN.js}"></script>
    <style>
        *{padding: 0px;margin:0px;}
        .a1{
            width:100%;border: 0px solid red;border-radius: 5px;font-size: 18px;text-align: center;background-color: #ddd;color: #333;
        }
        .a1 a{text-decoration: none;color:#fff;line-height: 2em;}
        .a1:active{
            background:#ccc;
        }
    </style>
</head>
<script type="text/javascript">
    document.oncontextmenu = function(){
        return false;
    }

    /**
     * easyui  格式化列
     * @param value
     * @param row
     * @param index
     * @returns {string}
     */
    function diyFormatter(value,row,index) {
        return "<span title='"+value+"'>"+value+"</span>";
    }

    /**
     * 格式化日期
     * @param date
     * @returns {string}
     */
    $.fn.datebox.defaults.formatter = function(date){
        var y = date.getFullYear();
        var m = date.getMonth()+1;
        var d = date.getDate();

        var hour = date.getHours(); // 时
        var minutes = date.getMinutes(); // 分
        var seconds = date.getSeconds() //秒
        return y+"-"+m+"-"+d;
    }

</script>
<body class="easyui-layout">
<div data-options="region:'west',title:'资源消息',split:true" style="width:230px;">

    <div id="aa" class="easyui-accordion"  data-options="fit:true,border:false" style="padding: 10px;">
        <div title="基础信息" style="overflow:auto;padding:10px;">
            <p class="a1">
                <a href = "javascript:getBaseVegetablesQuotation();">蔬菜行情模块</a>
            </p>
        </div>
    </div>


</div>
<div data-options="region:'center',title:'详细信息'">
    <div id = "detailinfo" style="display: none;width: 100%;height: 100%">


        <table id = "dg" style="width: 100%;height: 100%;margin: 0 auto" class="easyui-datagrid" data-options="
            url:'',
            singleSelect:true,
            striped:true,
            rownumbers:true,
            loadMsg:'数据处理中...',
            border:false,
            toolbar: '#toolbar'
        ">
            <thead>
                <tr>
                    <th data-options="field:'q_id',hidden:true,width:100,align:'center',halign:'center',formatter: diyFormatter">行情编号</th>
                    <th data-options="field:'c_name',width:100,align:'center',halign:'center',formatter: diyFormatter">蔬菜种类</th>
                    <th data-options="field:'v_name',width:100,align:'center',halign:'center',formatter: diyFormatter">蔬菜名称</th>
                    <th data-options="field:'s_name',width:100,align:'center',halign:'center',formatter: diyFormatter">蔬菜进货来源</th>
                    <th data-options="field:'q_investigation_date',width:130,align:'center',halign:'center',formatter: diyFormatter">调查时间</th>
                    <th data-options="field:'q_investigation_price',width:100,align:'center',halign:'center',formatter: diyFormatter">调查价格</th>
                    <th data-options="field:'q_price_increase',width:100,align:'center',halign:'center',formatter: diyFormatter">价格涨幅</th>
                    <th data-options="field:'q_del',width:100,align:'center',halign:'center',formatter: diyFormatter">是否逻辑删除</th>
                    <th data-options="field:'q_updatetime',width:130,align:'center',halign:'center',formatter: diyFormatter">修改时间</th>
                    <th data-options="field:'q_createtime',width:130,align:'center',halign:'center',formatter: diyFormatter">创建时间</th>
                </tr>
            </thead>
        </table>
    </div>

    <div id="toolbar">
        <div style="padding: 5px;">
            <div>
                调查价格(开始区间)&nbsp;:&nbsp;<input class="easyui-textbox" id = "q_start_investigation_price" name="q_start_investigation_price" placeholder="输入调查价格(开始区间)" />&nbsp;-
                <input class="easyui-textbox" id = "q_end_investigation_price" name="q_end_investigation_price" placeholder="输入调查价格(结束区间)" />
            </div>
            <div>
                价格涨幅(开始区间)&nbsp;:&nbsp;<input class="easyui-textbox" id = "q_start_price_increase" name="q_start_price_increase" placeholder="输入价格涨幅(开始区间)" />&nbsp;-
                <input class="easyui-textbox" id = "q_end_price_increase" name="q_end_price_increase" placeholder="输入价格涨幅(结束区间)" />
            </div>
            <div>
                是否逻辑删除&nbsp;:&nbsp;<select id="q_del" class="easyui-combobox" name="q_del" data-options="editable:false,disable:true" style="width:200px;">
                    <option value="">请选择</option>
                    <option value="01">已删除</option>
                    <option value="00">未删除</option>
                </select>
            </div>
            <div>
                修改数据时间(开始区间)&nbsp;:&nbsp;<input class="easyui-datebox" id ="q_start_updatetime" name="q_start_updatetime" data-options="showSeconds:false,editable:false" style="width:130px">&nbsp;-
                <input class="easyui-datebox" id ="q_end_updatetime" name="q_end_updatetime" data-options="showSeconds:false,editable:false" style="width:130px">
            </div>
            <a href="javascript:void(0)" onclick="add();" class="easyui-linkbutton" data-options="iconCls:'icon-add'" style="color: red;">新增</a>
            <a href="javascript:void(0)" onclick="edit();" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" style="color: red;">修改</a>
            <a href="javascript:void(0)" onclick="del();" class="easyui-linkbutton" data-options="iconCls:'icon-clear'" style="color: red;">删除</a>
            <a href="javascript:void(0)" onclick="filterDate();" class="easyui-linkbutton" data-options="iconCls:'icon-filter'" style="color: red;">条件过滤</a>
            <a href="javascript:void(0)" onclick="clearfilterDate();" class="easyui-linkbutton" data-options="iconCls:'icon-redo'" style="color: red;">清空条件过滤</a>
        </div>

    </div>


    <div id = "dd" style="display: none;margin: 0 auto;padding-top: 50px;">
        <p style="padding-left:2em;font-size: 3em;margin-bottom:0.5em;">车牌号：<span style="color: red;" id="platenum"></span></p>
        <p style="padding-left:2em;font-size: 3em;margin-bottom:0.5em;">描述：<span style="color: red;" id = "description"></span></p>
        <img style="margin-left:5em;" id = "img" src=""/>
    </div>
</div>

<div id="mm" class="easyui-menu" style="width:120px;">
    <div href="javascript:void(0)" data-options="iconCls:'icon-add'" onclick="add();" style="color: red;">新增</div>
    <div class="menu-sep"></div>
    <div href="javascript:void(0)" data-options="iconCls:'icon-edit'" onclick="edit();" style="color: red;">修改</div>
    <div class="menu-sep"></div>
    <div href="javascript:void(0)" data-options="iconCls:'icon-clear'" onclick="del();" style="color: red;">删除</div>
</div>
</body>

<div id="editDialog" >
        <table id = "detail" style="display: none;padding: 25px 0px 0px 36px;">
            <tr><td>蔬菜品种：</td><td><select id="edit_v_id" class="easyui-combobox" name="edit_v_id" data-options="editable:false,disable:true" style="width:150px;"></select></td></tr>
            <tr><td>进货来源：</td><td><select id="edit_s_id" class="easyui-combobox" name="edit_s_id" data-options="editable:false,disable:true" style="width:150px;"></select></td></tr>
            <tr><td>调查时间：</td><td><input class = "easyui-datetimebox" id="edit_q_investigation_date" name = "edit_q_investigation_date"  data-options="width:150"/><br/></td></tr>
            <tr><td>调查价格：</td><td><input class = "easyui-textbox" id="edit_q_investigation_price" name = "edit_q_investigation_price"  data-options="width:150"/><br/></td></tr>
            <tr><td>价格涨幅：</td><td><input class = "easyui-textbox" id="edit_q_price_increase" name = "edit_q_price_increase"  data-options="width:150"/><br/></td></tr>
            <tr><td>是否删除：</td><td>
                <select id="edit_q_del" class="easyui-combobox" name="edit_q_del" data-options="editable:false,disable:true" style="width:150px;">
                    <option value="">请选择</option>
                    <option value="01">已删除</option>
                    <option value="00">未删除</option>
                </select>
            <tr><td></td><td><br/><a id="saveBtn" href="javascript:editSave();" class="easyui-linkbutton">&nbsp;&nbsp;&nbsp;&nbsp;保&nbsp;&nbsp;存&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></td></tr>
        </table>
</div>




<script type="text/javascript">
    $(function () {
        resourceTree("","");
    });

    /**
     * 加载列表信息
     */
    function getBaseVegetablesQuotation () {
        $('#detailinfo').css("display","block");
        $('#dg').datagrid({
            url:'quotation/getBaseVegetablesQuotation',
            onRowContextMenu:function(e, rowIndex, rowData){
                if(rowData!=null){
                    $('#mm').menu('show', {
                        left: e.pageX,
                        top: e.pageY
                    });
                    row_data = rowData
                    console.info(row_data);
                }
            }
        });
    }

    /**
     * 过滤数据
     * */
    function filterDate() {
        var q_start_investigation_price = $('#q_start_investigation_price').textbox("getValue");
        var q_end_investigation_price = $('#q_end_investigation_price').textbox("getValue");
        var q_start_price_increase = $('#q_start_price_increase').textbox("getValue");
        var q_end_price_increase = $('#q_end_price_increase').textbox("getValue");
        var q_del = $('#q_del').combobox("getValue");
        var q_start_updatetime = $('#q_start_updatetime').datebox("getValue");
        var q_end_updatetime = $('#q_end_updatetime').datebox("getValue");

        var obj = {
            q_start_investigation_price: q_start_investigation_price,
            q_end_investigation_price: q_end_investigation_price,
            q_start_price_increase: q_start_price_increase,
            q_end_price_increase: q_end_price_increase,
            q_del: q_del,
            q_start_updatetime: q_start_updatetime,
            q_end_updatetime: q_end_updatetime
        }

        $('#dg').datagrid('load',{
            paramStr:JSON.stringify(obj)
        });

        /*alert("q_start_investigation_price:"+q_start_investigation_price);
        alert("q_end_investigation_price:"+q_end_investigation_price);
        alert("q_start_price_increase:"+q_start_price_increase);
        alert("q_end_price_increase:"+q_end_price_increase);
        alert("q_del:"+q_del);
        alert("q_start_updatetime:"+q_start_updatetime);
        alert("q_end_updatetime:"+q_end_updatetime);*/
    }

    /**
     * 清空条件过滤
     **/
    function clearfilterDate() {
        $('#q_start_investigation_price').textbox("setValue","");
        $('#q_end_investigation_price').textbox("setValue","");
        $('#q_start_price_increase').textbox("setValue","");
        $('#q_end_price_increase').textbox("setValue","");
        $('#q_del').combobox("setValue","");
        $('#q_start_updatetime').datebox("setValue","");
        $('#q_end_updatetime').datebox("setValue","");
    }


    //修改
    function edit(){
        $('#detail').css("display","block");
        var getRows = $('#dg').datagrid("getSelected"); //获取datagrid选中行
        console.info(getRows);
        if(getRows==null){
            $.messager.show({
                title:'系统消息',
                msg:'请选中一行蔬菜行情进行删除!',
                timeout:5000,
                showType:'slide'
            });
        }

        $('#edit_v_id').combobox({
            url:'varieties/getVarietiesCombobox',
            valueField:'id',
            textField:'text',
            onLoadSuccess: function () { //加载完成后,val[0]写死设置选中第一项
                var val = $(this).combobox("getData");
                for (var item in val) {
                    console.info(item);
                    if (item.id == getRows.v_id) {
                        $(this).combobox("select", val[item].id);
                    }
                }
            }
        });

        $('#edit_s_id').combobox({
            url:'purchaseSource/getBaseVegetablesPurchaseSourceCombobox',
            valueField:'id',
            textField:'text',
            onLoadSuccess: function () { //加载完成后,val[0]写死设置选中第一项
                var val = $(this).combobox("getData");
                for (var item in val) {
                    console.info(item);
                    if (item.id == getRows.v_id) {
                        $(this).combobox("select", val[item].id);
                    }
                }
            }
        });

        $('#editDialog').window({
            title:'编辑蔬菜行情详细信息',
            width:330,
            height:305,
            modal:true
        });

        $('#edit_v_id').textbox("setValue",getRows.v_id);
        $('#edit_s_id').textbox("setValue",getRows.s_id);
        $('#edit_q_investigation_date').datetimebox("setValue",getRows.q_investigation_date);
        $('#edit_q_investigation_price').textbox("setValue",getRows.q_investigation_price);
        $('#edit_q_price_increase').textbox("setValue",getRows.q_price_increase);
        $('#edit_q_del').combobox("setValue",getRows.q_del);
        $('#editDialog').dialog('open');
    }

    //确认修改
    function editSave() {
        var edit_v_id = $('#edit_v_id').textbox("getValue");
        var edit_s_id = $('#edit_s_id').textbox("getValue");
        var edit_q_investigation_date = $('#edit_q_investigation_date').datetimebox("getValue");
        var edit_q_investigation_price = $('#edit_q_investigation_price').textbox("getValue");
        var edit_q_price_increase = $('#edit_q_price_increase').textbox("getValue");
        var edit_q_del = $('#edit_q_del').combobox("getValue");

        var obj = {
            edit_v_id : edit_v_id,
            edit_s_id : edit_s_id,
            edit_q_investigation_date : edit_q_investigation_date,
            edit_q_investigation_price : edit_q_investigation_price,
            edit_q_price_increase : edit_q_price_increase,
            edit_q_del : edit_q_del
        }

        $.ajax({
            url:'quotation/BaseVegetablesQuotation',
            method:'post',
            data:{
                paramStr:JSON.stringify(obj)
            },
            success : function(data){
                if(data=="00"){
                    $('#dialog').dialog("close");
                    $('#dg').datagrid('reload');
                    $.messager.show({
                        title:'系统消息',
                        msg:'修改成功',
                        timeout:3000,
                        showType:'slide'
                    });
                }else{
                    $.messager.show({
                        title:'系统消息',
                        msg:'修改失败',
                        timeout:3000,
                        showType:'slide'
                    });
                }
            },
            error : function(a,b,c){
                $.messager.show({
                    title:'系统消息',
                    msg:'修改异常',
                    timeout:3000,
                    showType:'slide'
                });
            }
        });
    }

    //删除
    function del() {
        $.messager.confirm('系统确认', '您确定要删除手机号为 ['+row_data.phone+'] 的机主么,请谨慎操作?', function(r){
            if (r){
                $.ajax({
                    url:'user/deleteWhite',
                    method:'post',
                    data:{
                        id:row_data.id
                    },
                    success : function(data){
                        if(data=="00"){
                            $('#dg').datagrid('reload');
                            $.messager.show({
                                title:'系统消息',
                                msg:'删除成功',
                                timeout:3000,
                                showType:'slide'
                            });
                        }else{
                            $.messager.show({
                                title:'系统消息',
                                msg:'删除失败',
                                timeout:3000,
                                showType:'slide'
                            });
                        }
                    },
                    error : function(a,b,c){
                        $.messager.show({
                            title:'系统消息',
                            msg:'删除异常',
                            timeout:3000,
                            showType:'slide'
                        });
                    }
                });
            }
        });
    }


    /**
     * 过滤资源信息
     */
    function filterResourceTree() {
        var beginDate = $('#beginDate').datetimebox('getValue');
        var endDate = $('#endDate').datetimebox('getValue');
        resourceTree(beginDate,endDate);
    }

    /**
     * 加载资源信息
     * @param beginDate
     * @param endDate
     */
    function resourceTree(beginDate,endDate) {
        $('#tt').tree({
            url: "quotation/getBaseVegetablesQuotation",
            onClick: function(node){
                if(typeof(node.children)=='undefined'){
                    $.ajax({
                        url:'user/getOneBaseResourceDetail',
                        method:'post',
                        data:{
                            id : node.id
                        },
                        success : function (data) {
                            $('#dd').css("display","block");
                            $('#bb').css("display","none");
                            $('#img').attr("src",data.imgurl);
                            $('#platenum').html(data.platenum);
                            $('#description').html(data.description);
                        },
                        error : function (a,b,c) {
                            $.messager.show({
                                title:'系统消息',
                                msg:'获取['+node.text+']车牌号详细信息失败!',
                                timeout:3000,
                                showType:'slide'
                            });
                        }
                    });
                }

            }
        });
    }

    var row_data = {};




</script>
</html>